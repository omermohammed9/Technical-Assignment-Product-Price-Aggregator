<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Product Changes</title>
</head>
<body>
<h1>üìä Live Product Changes</h1>
<ul id="product-changes"></ul>

<script>
  const eventSource = new EventSource("http://localhost:3000/products/live-changes");

  eventSource.onmessage = function (event) {
    console.log("üîÑ SSE Event Received:", event.data); // Debugging in console

    try {
      const updates = JSON.parse(event.data); // Parse incoming JSON

      const list = document.getElementById("product-changes");
      list.innerHTML = ""; // Clear previous updates

      updates.forEach(update => {
        const listItem = document.createElement("li");

        // ‚úÖ Fix Undefined Values & Format Data
        const productName = update.name || "Unknown Product";
        const oldPrice = update.oldPrice !== undefined ? `$${update.oldPrice.toFixed(2)}` : "N/A";
        const newPrice = update.newPrice !== undefined ? `$${update.newPrice.toFixed(2)}` : "N/A";
        const updatedTime = new Date(update.timestamp).toLocaleString();

        listItem.textContent = `${productName}: Old Price ${oldPrice} ‚Üí New Price ${newPrice} | Updated at: ${updatedTime}`;
        list.appendChild(listItem);
      });

    } catch (error) {
      console.error("‚ùå Error Parsing SSE Data:", error);
    }
  };

  eventSource.onerror = function (error) {
    console.error("‚ùå SSE Connection Error:", error);
  };
</script>
</body>
</html>
